<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extend the payslip batch form view to add the smart button -->
    <record id="hr_payslip_run_form_view_inherit_saib" model="ir.ui.view">
        <field name="name">hr.payslip.run.form.inherit.saib</field>
        <field name="model">hr.payslip.run</field>
        <field name="inherit_id" ref="hr_payroll.hr_payslip_run_form"/>
        <field name="arch" type="xml">
            <!-- Add the smart button in the button box -->
            <div name="button_box" position="inside">
                <button name="action_view_saib_payrolls" type="object" class="oe_stat_button" icon="fa-bank">
                    <field name="saib_payroll_count" widget="statinfo" string="SAIB Payrolls"/>
                </button>
            </div>

            <!-- Add the button to create SAIB payroll -->
            <xpath expr="//header" position="inside">
                <button name="action_send_to_saib" string="Send to SAIB Bank" type="object" class="oe_highlight" invisible="state != 'close' or saib_payment_id == True"/>
                <field name="saib_payment_id" readonly="1" invisible="not saib_payment_id"/>
            </xpath>

            <!-- Add the new state to the statusbar -->
            <xpath expr="//field[@name='state']" position="attributes">
                <attribute name="statusbar_visible">draft,verify,done,sent_to_bank,close</attribute>
            </xpath>
            
            <!-- Add the effective date fields -->
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="regular_effective_date" placeholder="Regular Payment Date" required="[('state', '=', 'draft')]" />
                <field name="adjustment_effective_date" placeholder="Adjustment Payment Date"  required="[('state', '=', 'draft')]" />
            </xpath>
        </field>
    </record>
</odoo>
